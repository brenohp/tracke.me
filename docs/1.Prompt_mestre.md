Olá! Vamos continuar o desenvolvimento do projeto **CliendaApp**.

Esta mensagem serve como a base de conhecimento e o guia de padrões para este projeto. Por favor, absorva estas informações e siga-as rigorosamente em todo o desenvolvimento.

### 1. Visão Geral do Projeto

* **Nome:** CliendaApp
* **Missão:** Um SaaS para pequenos negócios (salões de beleza, barbearias, etc.) que simplifica a gestão de clientes e agenda, com um diferencial de automação de agendamentos via IA no WhatsApp.
* **Foco:** Facilidade de uso extrema para usuários com pouca familiaridade tecnológica.

### 2. Stack de Tecnologias

* **Framework:** Next.js (App Router)
* **Linguagem:** TypeScript
* **Estilização:** Tailwind CSS
* **Banco de Dados:** PostgreSQL
* **ORM:** Prisma
* **WEBSOCKETS:** Pusher

### 3. Padrões de Arquitetura e Código (Indispensáveis)

#### 3.1. Arquitetura de Componentes (Next.js App Router)

* **Server Components (`page.tsx`, `layout.tsx`):** São o padrão. **Nunca** devem ter a diretiva `"use client";"`. As suas responsabilidades são:
    1.  Buscar dados diretamente do banco de dados (`prisma`).
    2.  Verificar a autenticação e as permissões.
    3.  Passar os dados para os Componentes de Cliente como `props`.
* **Client Components (`"use client";`):** Usados apenas para interatividade.
    1.  Qualquer componente que use hooks como `useState`, `useEffect`, ou eventos como `onClick` deve ser um Componente de Cliente, isolado no seu próprio ficheiro.
    2.  O `layout.tsx` do dashboard usa o padrão "Shell": o layout em si é de servidor, mas ele renderiza um componente de cliente (`DashboardShell.tsx`) que contém toda a parte interativa (menus, etc.).

#### 3.2. Fluxo de Dados (Server -> Client)

* **Serialização é Obrigatória:** Ao passar dados de um Componente de Servidor para um de Cliente, tipos complexos como `Decimal` e `Date` devem ser convertidos para tipos simples.
    * `Decimal` -> `.toString()`
    * `Date` -> `.toISOString()`
    * `Json` -> `JSON.stringify()`

#### 3.3. Autenticação e APIs

* **Método de Autenticação:** A autenticação é feita exclusivamente via **cookies `httpOnly`**. As APIs **não** usam `Bearer token` no cabeçalho.
* **Leitura de Cookies na API:** As rotas de API devem usar `await cookies()` de `next/headers` para ler o token.
* **Segurança de Rotas:**
    * Rotas do dashboard do cliente (`/api/...`) são protegidas e validam a sessão do usuário.
    * Rotas do painel de admin (`/api/admin/...`) são protegidas e devem verificar especificamente se `session.role === 'ADMIN'`.

#### 3.4. Padrões de UI/UX

* **Paleta de Cores (Padrão "Maré Noturna"):** Devemos usar as seguintes cores de marca, que estarão configuradas no `tailwind.config.ts`:
    ```javascript
    // tailwind.config.ts
    colors: {
      'brand-background': '#F7F7F7',      // Fundo claro
      'brand-primary': '#021B33',         // Azul escuro, quase preto (texto/elementos chave)
      'brand-accent': '#12577B',          // Azul acentuado (botões, destaques)
      'brand-accent-light': '#A9CFE5',    // Azul claro (fundos sutis, hovers)
    },
    ```
* **Notificações:** Todas as mensagens de feedback para o usuário (sucesso, erro, etc.) devem ser feitas usando a biblioteca **`react-hot-toast`** (toasty).
* **CRUD em Modais:** Todas as operações de Criar e Editar são feitas dentro de componentes de Modal para manter a interface limpa. Usamos um componente genérico `Modal.tsx`.
* **Estrutura de Ficheiros:** Para cada secção (ex: `services`, `clients`), a estrutura é:
    * `/services/page.tsx` (Servidor)
    * `/services/_components/ServicesView.tsx` (Cliente, exibe a tabela)
    * `/services/_components/ServiceForm.tsx` (Cliente, o formulário)

### 4. Ambiente de Desenvolvimento

* **URL Local:** Usamos **`lvh.me:3000`** para o desenvolvimento, para garantir o funcionamento correto dos cookies entre o domínio principal e os subdomínios.
* **Configuração do Cookie:** A propriedade `sameSite` do cookie deve ser definida como `'lax'` para permitir o redirecionamento entre o domínio principal e os subdomínios.

### 5. Nosso Próximo Passo

O nosso foco atual é finalizar o **Módulo 5: Faturamento e Checkout**. O primeiro passo é a **integração com um gateway de pagamento (Stripe)**.

---

Por favor, confirme que você entendeu todas estas regras. Na minha próxima mensagem, enviarei o `schema.prisma` completo para que você tenha a estrutura de dados final.


Observações: Trate de usar a sintaxe e padrões de códigos mais atuais de acordo com os frameworks e ferramentas que estamos utilizando, para evitar erros e frustrações futuras.